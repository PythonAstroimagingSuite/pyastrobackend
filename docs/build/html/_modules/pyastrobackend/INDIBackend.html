

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyastrobackend.INDIBackend &mdash; pyastrobackend 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> pyastrobackend
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyastrobackend</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>pyastrobackend.INDIBackend</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyastrobackend.INDIBackend</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="k">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">queue</span> <span class="k">import</span> <span class="n">Queue</span>

<span class="kn">import</span> <span class="nn">ctypes</span>

<span class="c1">#import numpy as np</span>
<span class="kn">import</span> <span class="nn">astropy.io.fits</span> <span class="k">as</span> <span class="nn">pyfits</span>

<span class="kn">import</span> <span class="nn">PyIndi</span>

<span class="kn">from</span> <span class="nn">pyastrobackend.BaseBackend</span> <span class="k">import</span> <span class="n">BaseDeviceBackend</span><span class="p">,</span> <span class="n">BaseCamera</span><span class="p">,</span> <span class="n">BaseFocuser</span>
<span class="kn">from</span> <span class="nn">pyastrobackend.BaseBackend</span> <span class="k">import</span> <span class="n">BaseFilterWheel</span><span class="p">,</span> <span class="n">BaseMount</span>
<span class="kn">import</span> <span class="nn">pyastrobackend.INDI.IndiHelper</span> <span class="k">as</span> <span class="nn">indihelper</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;always&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>


<div class="viewcode-block" id="DeviceBackend"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend">[docs]</a><span class="k">class</span> <span class="nc">DeviceBackend</span><span class="p">(</span><span class="n">BaseDeviceBackend</span><span class="p">):</span>
    <span class="c1"># INDI client connection</span>
<span class="c1">#    indiclient=None</span>

<div class="viewcode-block" id="DeviceBackend.IndiClient"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.IndiClient">[docs]</a>    <span class="k">class</span> <span class="nc">IndiClient</span><span class="p">(</span><span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseClient</span><span class="p">):</span>
        <span class="c1"># needed for ccd callback</span>
        <span class="c1">#blobEvent = None</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventQueue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blobEvent</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># FIXME probably need to do this through a queue or callback!</span>
<div class="viewcode-block" id="DeviceBackend.IndiClient.getBlobEvent"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.IndiClient.getBlobEvent">[docs]</a>        <span class="k">def</span> <span class="nf">getBlobEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">blobEvent</span></div>

<div class="viewcode-block" id="DeviceBackend.IndiClient.clearBlobEvent"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.IndiClient.clearBlobEvent">[docs]</a>        <span class="k">def</span> <span class="nf">clearBlobEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blobEvent</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="DeviceBackend.IndiClient.getEventQueue"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.IndiClient.getEventQueue">[docs]</a>        <span class="k">def</span> <span class="nf">getEventQueue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventQueue</span></div>

<div class="viewcode-block" id="DeviceBackend.IndiClient.newDevice"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.IndiClient.newDevice">[docs]</a>        <span class="k">def</span> <span class="nf">newDevice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
            <span class="c1">#logging.debug(&#39;newDevice: &#39;)</span>
            <span class="c1">#logging.debug(indihelper.dump_Device(d))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventQueue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>

<div class="viewcode-block" id="DeviceBackend.IndiClient.newProperty"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.IndiClient.newProperty">[docs]</a>        <span class="k">def</span> <span class="nf">newProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="c1">#print(&#39;newprop:&#39;, p.getName(), &#39; type =&#39;, indihelper.strGetType(p))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventQueue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></div>

<div class="viewcode-block" id="DeviceBackend.IndiClient.removeProperty"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.IndiClient.removeProperty">[docs]</a>        <span class="k">def</span> <span class="nf">removeProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="c1">#print(&#39;delprop:&#39;, p.getName(), &#39; type =&#39;, indihelper.strGetType(p))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventQueue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></div>

<div class="viewcode-block" id="DeviceBackend.IndiClient.newBLOB"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.IndiClient.newBLOB">[docs]</a>        <span class="k">def</span> <span class="nf">newBLOB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bp</span><span class="p">):</span>
<span class="c1"># FIXME Global is BAD</span>
            <span class="c1">#global blobEvent</span>
            <span class="c1">#print(&#39;blob&#39;)</span>
            <span class="c1">#self.eventQueue.put(bp)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blobEvent</span> <span class="o">=</span> <span class="n">bp</span></div>

<div class="viewcode-block" id="DeviceBackend.IndiClient.newSwitch"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.IndiClient.newSwitch">[docs]</a>        <span class="k">def</span> <span class="nf">newSwitch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">svp</span><span class="p">):</span>
            <span class="c1">#print(&#39;newSwitch:&#39;, svp.name)</span>
            <span class="c1">#print(indihelper.dump_ISwitchVectorProperty(svp))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventQueue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">svp</span><span class="p">)</span></div>

<div class="viewcode-block" id="DeviceBackend.IndiClient.newNumber"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.IndiClient.newNumber">[docs]</a>        <span class="k">def</span> <span class="nf">newNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nvp</span><span class="p">):</span>
<span class="c1">#            print(&#39;num:&#39;, nvp.name)</span>
<span class="c1">#            print(indihelper.dump_INumberVectorProperty(nvp))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventQueue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">nvp</span><span class="p">)</span></div>

<div class="viewcode-block" id="DeviceBackend.IndiClient.newText"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.IndiClient.newText">[docs]</a>        <span class="k">def</span> <span class="nf">newText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tvp</span><span class="p">):</span>
<span class="c1">#            print(&#39;text:&#39;, tvp.name)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventQueue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">tvp</span><span class="p">)</span></div>

<div class="viewcode-block" id="DeviceBackend.IndiClient.newLight"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.IndiClient.newLight">[docs]</a>        <span class="k">def</span> <span class="nf">newLight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lvp</span><span class="p">):</span>
<span class="c1">#            print(&#39;light:&#39;, lvp.name)</span>
<span class="c1">#            print(lvp)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventQueue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">lvp</span><span class="p">)</span></div>

<div class="viewcode-block" id="DeviceBackend.IndiClient.newMessage"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.IndiClient.newMessage">[docs]</a>        <span class="k">def</span> <span class="nf">newMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<span class="c1">#            print(&#39;msg:&#39;, d, m)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventQueue</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">d</span><span class="p">,</span><span class="n">m</span><span class="p">))</span></div>

<div class="viewcode-block" id="DeviceBackend.IndiClient.serverConnected"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.IndiClient.serverConnected">[docs]</a>        <span class="k">def</span> <span class="nf">serverConnected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="DeviceBackend.IndiClient.serverDisconnected"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.IndiClient.serverDisconnected">[docs]</a>        <span class="k">def</span> <span class="nf">serverDisconnected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
            <span class="k">pass</span></div></div>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cam</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indiclient</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="DeviceBackend.connect"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;connect() already connected!&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indiclient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;connect() indiclient is not None!&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">indiclient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IndiClient</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indiclient</span><span class="o">.</span><span class="n">setServer</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">7624</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;self.indiclient = </span><span class="si">{self.indiclient}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">indiclient</span><span class="o">.</span><span class="n">connectServer</span><span class="p">():</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;connect() failed to connect to Indi server!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="DeviceBackend.disconnect"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indiclient</span><span class="o">.</span><span class="n">disconnectServer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indiclient</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="DeviceBackend.isConnected"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.isConnected">[docs]</a>    <span class="k">def</span> <span class="nf">isConnected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span></div>

<div class="viewcode-block" id="DeviceBackend.newCamera"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.newCamera">[docs]</a>    <span class="k">def</span> <span class="nf">newCamera</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Camera</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="DeviceBackend.newFocuser"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.newFocuser">[docs]</a>    <span class="k">def</span> <span class="nf">newFocuser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Focuser</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="DeviceBackend.newFilterWheel"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.newFilterWheel">[docs]</a>    <span class="k">def</span> <span class="nf">newFilterWheel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FilterWheel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="DeviceBackend.newMount"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.newMount">[docs]</a>    <span class="k">def</span> <span class="nf">newMount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Mount</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<span class="c1">#</span>
<span class="c1"># from https://github.com/GuLinux/indi-lite-tools/blob/e1f6fa52b59474d5d27eba571c87ae67d2cd1724/pyindi_sequence/device.py</span>
<span class="c1">#</span>
<div class="viewcode-block" id="DeviceBackend.findDeviceInterfaces"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.findDeviceInterfaces">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">findDeviceInterfaces</span><span class="p">(</span><span class="n">indidevice</span><span class="p">):</span>
        <span class="n">interface</span> <span class="o">=</span> <span class="n">indidevice</span><span class="o">.</span><span class="n">getDriverInterface</span><span class="p">()</span>
        <span class="n">interface</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="n">device_interfaces</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">interface</span><span class="o">.</span><span class="fm">__int__</span><span class="p">(),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint16</span><span class="p">))</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">interface</span><span class="o">.</span><span class="n">disown</span><span class="p">()</span>
        <span class="n">interfaces</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseDevice</span><span class="o">.</span><span class="n">GENERAL_INTERFACE</span><span class="p">:</span> <span class="s1">&#39;general&#39;</span><span class="p">,</span>
            <span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseDevice</span><span class="o">.</span><span class="n">TELESCOPE_INTERFACE</span><span class="p">:</span> <span class="s1">&#39;telescope&#39;</span><span class="p">,</span>
            <span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseDevice</span><span class="o">.</span><span class="n">CCD_INTERFACE</span><span class="p">:</span> <span class="s1">&#39;ccd&#39;</span><span class="p">,</span>
            <span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseDevice</span><span class="o">.</span><span class="n">GUIDER_INTERFACE</span><span class="p">:</span> <span class="s1">&#39;guider&#39;</span><span class="p">,</span>
            <span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseDevice</span><span class="o">.</span><span class="n">FOCUSER_INTERFACE</span><span class="p">:</span> <span class="s1">&#39;focuser&#39;</span><span class="p">,</span>
            <span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseDevice</span><span class="o">.</span><span class="n">FILTER_INTERFACE</span><span class="p">:</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span>
            <span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseDevice</span><span class="o">.</span><span class="n">DOME_INTERFACE</span><span class="p">:</span> <span class="s1">&#39;dome&#39;</span><span class="p">,</span>
            <span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseDevice</span><span class="o">.</span><span class="n">GPS_INTERFACE</span><span class="p">:</span> <span class="s1">&#39;gps&#39;</span><span class="p">,</span>
            <span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseDevice</span><span class="o">.</span><span class="n">WEATHER_INTERFACE</span><span class="p">:</span> <span class="s1">&#39;weather&#39;</span><span class="p">,</span>
            <span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseDevice</span><span class="o">.</span><span class="n">AO_INTERFACE</span><span class="p">:</span> <span class="s1">&#39;ao&#39;</span><span class="p">,</span>
            <span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseDevice</span><span class="o">.</span><span class="n">DUSTCAP_INTERFACE</span><span class="p">:</span> <span class="s1">&#39;dustcap&#39;</span><span class="p">,</span>
            <span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseDevice</span><span class="o">.</span><span class="n">LIGHTBOX_INTERFACE</span><span class="p">:</span> <span class="s1">&#39;lightbox&#39;</span><span class="p">,</span>
            <span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseDevice</span><span class="o">.</span><span class="n">DETECTOR_INTERFACE</span><span class="p">:</span> <span class="s1">&#39;detector&#39;</span><span class="p">,</span>
            <span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseDevice</span><span class="o">.</span><span class="n">ROTATOR_INTERFACE</span><span class="p">:</span> <span class="s1">&#39;rotator&#39;</span><span class="p">,</span>
            <span class="n">PyIndi</span><span class="o">.</span><span class="n">BaseDevice</span><span class="o">.</span><span class="n">AUX_INTERFACE</span><span class="p">:</span> <span class="s1">&#39;aux&#39;</span>
        <span class="p">}</span>
        <span class="n">interfaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">interfaces</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">interfaces</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="n">device_interfaces</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">interfaces</span></div>

<div class="viewcode-block" id="DeviceBackend.getDevicesByClass"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.DeviceBackend.getDevicesByClass">[docs]</a>    <span class="k">def</span> <span class="nf">getDevicesByClass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_class</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; class is one of:</span>
<span class="sd">               &#39;ccd&#39;</span>
<span class="sd">               &#39;focuser&#39;</span>
<span class="sd">               &#39;filter&#39;</span>
<span class="sd">               &#39;telscope&#39;</span>
<span class="sd">               &#39;guider&#39;       &quot;&quot;&quot;</span>

        <span class="n">devs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indiclient</span><span class="o">.</span><span class="n">getDevices</span><span class="p">()</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">devs</span><span class="p">:</span>
            <span class="n">interfaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findDeviceInterfaces</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">device_class</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">:</span>
                <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">getDeviceName</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">matches</span></div></div>

<div class="viewcode-block" id="Camera"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera">[docs]</a><span class="k">class</span> <span class="nc">Camera</span><span class="p">(</span><span class="n">BaseCamera</span><span class="p">):</span>

<div class="viewcode-block" id="Camera.CameraSettings"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.CameraSettings">[docs]</a>    <span class="k">class</span> <span class="nc">CameraSettings</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Camera.CCD_INFO"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.CCD_INFO">[docs]</a>    <span class="k">class</span> <span class="nc">CCD_INFO</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cam</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indiclient</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_has_progress</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># some cameras do not have this and we cache this</span>
        <span class="c1"># information after first attempt since the</span>
        <span class="c1"># timeout waiting on this hurts monitoring loops</span>
        <span class="c1"># in client software</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_has_cooler_power</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># INDI doesnt seem to have a way to access target temperature</span>
        <span class="c1"># so we keep up with it whenever the client changing it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature_target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">5</span>

<div class="viewcode-block" id="Camera.has_chooser"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.has_chooser">[docs]</a>    <span class="k">def</span> <span class="nf">has_chooser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Camera.show_chooser"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.show_chooser">[docs]</a>    <span class="k">def</span> <span class="nf">show_chooser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_choice</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Camera.show_chooser() is not implemented for INDI!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Camera.connect"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Connecting to camera device: </span><span class="si">{name}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Camera.connect() self.cam is not None!&#39;</span><span class="p">)</span>

        <span class="n">cam</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">connectDevice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="c1">#logging.info(f&#39;connectDevice returned {cam}&#39;)</span>

        <span class="k">if</span> <span class="n">cam</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cam</span> <span class="o">=</span> <span class="n">cam</span>

            <span class="c1"># reset some flags</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera_has_progress</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera_has_cooler_power</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temperature_target</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Camera.disconnect"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#logging.warning(&#39;Camera.disconnect() is not implemented for INDI!&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cam</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Camera.is_connected"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.is_connected">[docs]</a>    <span class="k">def</span> <span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="o">.</span><span class="n">isConnected</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Camera.get_camera_name"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_camera_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_camera_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>
<span class="c1">#        logging.warning(&#39;Camera.get_camera_name() is not implemented for INDI!&#39;)</span>
<span class="c1">#        return None</span>


<div class="viewcode-block" id="Camera.get_camera_description"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_camera_description">[docs]</a>    <span class="k">def</span> <span class="nf">get_camera_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Camera.get_camera_description() is not implemented for INDI!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="o">.</span><span class="n">Description</span></div>

<div class="viewcode-block" id="Camera.get_driver_info"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_driver_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_driver_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Camera.get_driver_info() is not implemented for INDI!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="o">.</span><span class="n">DriverInfo</span></div>

<div class="viewcode-block" id="Camera.get_driver_version"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_driver_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_driver_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="o">.</span><span class="n">getDriverVersion</span><span class="p">()</span></div>

<span class="c1">#        logging.warning(&#39;Camera.get_driver_version() is not implemented for INDI!&#39;)</span>
<span class="c1">#        return None</span>


<div class="viewcode-block" id="Camera.get_state"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># FIXME using hard coded values based on ASCOM camera state</span>
        <span class="c1"># and definied in pyastroimageview.CameraManager.CameraState!</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumberState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_EXPOSURE&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># UNKNOWN</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PyIndi</span><span class="o">.</span><span class="n">IPS_BUSY</span><span class="p">:</span>
            <span class="c1"># just use EXPOSING</span>
            <span class="k">return</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PyIndi</span><span class="o">.</span><span class="n">IPS_ALERT</span><span class="p">:</span>
            <span class="c1"># ERROR</span>
            <span class="k">return</span> <span class="mi">5</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PyIndi</span><span class="o">.</span><span class="n">IPS_IDLE</span> <span class="ow">or</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PyIndi</span><span class="o">.</span><span class="n">IPS_OK</span><span class="p">:</span>
            <span class="c1"># IDLE</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># otherwise UNKNOWN</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>

<div class="viewcode-block" id="Camera.start_exposure"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.start_exposure">[docs]</a>    <span class="k">def</span> <span class="nf">start_exposure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expos</span><span class="p">):</span>
 <span class="c1">#       global blobEvent</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Exposing image for </span><span class="si">{expos}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>

        <span class="c1"># FIXME currently always requesting a light frame</span>
        <span class="c1"># FIXME need to check return codes of all steps</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">:</span>
            <span class="n">ccd_exposure</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_EXPOSURE&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ccd_exposure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># we should inform the indi server that we want to receive the</span>
            <span class="c1"># &#39;CCD1&#39; blob from this device</span>
            <span class="c1"># FIXME not good to reference global &#39;config&#39; here - we already pass</span>
            <span class="c1">#       a device object should combine?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="o">.</span><span class="n">setBLOBMode</span><span class="p">(</span><span class="n">PyIndi</span><span class="o">.</span><span class="n">B_ALSO</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;CCD1&#39;</span><span class="p">)</span>

            <span class="n">ccd_ccd1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="o">.</span><span class="n">getBLOB</span><span class="p">(</span><span class="s1">&#39;CCD1&#39;</span><span class="p">)</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">ccd_ccd1</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
                <span class="n">ccd_ccd1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">getBLOB</span><span class="p">(</span><span class="s1">&#39;CCD1&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="o">.</span><span class="n">clearBlobEvent</span><span class="p">()</span>

            <span class="n">ccd_expnum</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_exposure</span><span class="p">,</span> <span class="s1">&#39;CCD_EXPOSURE_VALUE&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ccd_expnum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">ccd_expnum</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">expos</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="o">.</span><span class="n">sendNewNumber</span><span class="p">(</span><span class="n">ccd_exposure</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Camera.stop_exposure"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.stop_exposure">[docs]</a>    <span class="k">def</span> <span class="nf">stop_exposure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># had trouble using the setfindSwitchState function for some reason!</span>
        <span class="n">retries</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sw_prop</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">retries</span><span class="p">:</span>
            <span class="c1">#logging.info(&#39;Trying to get CCD_ABORT_EXPOSURE&#39;)</span>
            <span class="n">sw_prop</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getSwitch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_ABORT_EXPOSURE&#39;</span><span class="p">)</span>
            <span class="c1">#logging.info(f&#39;sw_prop = {sw_prop}&#39;)</span>
            <span class="k">if</span> <span class="n">sw_prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">sw_prop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">sw</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">retries</span><span class="p">:</span>
             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Trying to get ABORT&#39;</span><span class="p">)</span>
             <span class="n">sw</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findSwitch</span><span class="p">(</span><span class="n">sw_prop</span><span class="p">,</span> <span class="s1">&#39;ABORT&#39;</span><span class="p">)</span>
             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;sw = </span><span class="si">{sw}</span><span class="s1">&#39;</span><span class="p">)</span>
             <span class="k">if</span> <span class="n">sw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                 <span class="k">break</span>
             <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">sw</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">PyIndi</span><span class="o">.</span><span class="n">ISS_ON</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="o">.</span><span class="n">sendNewSwitch</span><span class="p">(</span><span class="n">sw_prop</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<span class="c1">#        rc = indihelper.setfindSwitchState(self.backend.indiclient, self.cam,</span>
<span class="c1">#                                          &#39;CCD_ABORT_EXPOURE&#39;, &#39;ABORT&#39;,</span>
<span class="c1">#                                           True)</span>
<span class="c1">#        print(rc)</span>
<span class="c1">#        return rc</span>

<span class="c1">#        logging.warning(&#39;Camera.stop_exposure() is not implemented for INDI!&#39;)</span>
<span class="c1">#        return None</span>

<div class="viewcode-block" id="Camera.check_exposure"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.check_exposure">[docs]</a>    <span class="k">def</span> <span class="nf">check_exposure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># FIXME accessing blob event seems like a poor choice</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="o">.</span><span class="n">getBlobEvent</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Camera.get_min_max_exposure"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_min_max_exposure">[docs]</a>    <span class="k">def</span> <span class="nf">get_min_max_exposure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">:</span>
            <span class="n">ccd_exposure</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_EXPOSURE&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ccd_exposure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">ccd_expnum</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_exposure</span><span class="p">,</span> <span class="s1">&#39;CCD_EXPOSURE_VALUE&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ccd_expnum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">ccd_expnum</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">ccd_expnum</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Camera.supports_progress"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.supports_progress">[docs]</a>    <span class="k">def</span> <span class="nf">supports_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Camera.supports_progress() is not implemented for INDI!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="c1">#        logging.info(f&#39;ascomcamera: supports_progress {self.camera_has_progress}&#39;)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera_has_progress</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera_has_progress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_exposure_progress</span><span class="p">()</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
<span class="c1">#        logging.info(f&#39;ascomcamera: supports_progress return  {self.camera_has_progress}&#39;)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera_has_progress</span></div>

<span class="c1"># FIXME returns -1 to indicate progress is not available</span>
<span class="c1"># FIXME shold use cached value to know if progress is supported</span>
<div class="viewcode-block" id="Camera.get_exposure_progress"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_exposure_progress">[docs]</a>    <span class="k">def</span> <span class="nf">get_exposure_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Camera.get_exposure_progress() is not implemented for INDI!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="o">.</span><span class="n">PercentCompleted</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;camera.get_exposure_progress() failed!&#39;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Exception -&gt;&#39;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>

<div class="viewcode-block" id="Camera.get_image_data"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_image_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get image data from camera</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        image_data : numpy array</span>
<span class="sd">            Data is in row-major format!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blobEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="o">.</span><span class="n">getBlobEvent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">blobEvent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Camera.get_image_data() blobEvent is None!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">blob</span> <span class="o">=</span> <span class="n">blobEvent</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blob</span><span class="p">,</span> <span class="n">PyIndi</span><span class="o">.</span><span class="n">IBLOB</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Camera.get_image_data() - no blob ready!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">fits</span><span class="o">=</span><span class="n">blob</span><span class="o">.</span><span class="n">getblobdata</span><span class="p">()</span>

        <span class="n">blobfile</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">fits</span><span class="p">)</span>

        <span class="n">hdulist</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">blobfile</span><span class="p">)</span>

<span class="c1"># FIXME ASCOM get_image_data returns a numpy array of the native camera data type!</span>
        <span class="k">return</span> <span class="n">hdulist</span></div>

<div class="viewcode-block" id="Camera.get_info"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ccd_info</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_INFO&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ccd_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">maxx</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_info</span><span class="p">,</span> <span class="s1">&#39;CCD_MAX_X&#39;</span><span class="p">)</span>
        <span class="n">maxy</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_info</span><span class="p">,</span> <span class="s1">&#39;CCD_MAX_Y&#39;</span><span class="p">)</span>
        <span class="n">pix_size</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_info</span><span class="p">,</span> <span class="s1">&#39;CCD_PIXEL_SIZE&#39;</span><span class="p">)</span>
        <span class="n">pix_size_x</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_info</span><span class="p">,</span> <span class="s1">&#39;CCD_PIXEL_SIZE_X&#39;</span><span class="p">)</span>
        <span class="n">pix_size_y</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_info</span><span class="p">,</span> <span class="s1">&#39;CCD_PIXEL_SIZE_Y&#39;</span><span class="p">)</span>
        <span class="n">bpp</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_info</span><span class="p">,</span> <span class="s1">&#39;CCD_BITSPERPIXEL&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">maxx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">maxy</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">is</span> <span class="n">pix_size</span> <span class="ow">is</span> <span class="kc">None</span> \
           <span class="ow">or</span> <span class="n">pix_size_x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pix_size_y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">bpp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
               <span class="k">return</span> <span class="kc">None</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CCD_INFO</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">CCD_MAX_X</span> <span class="o">=</span> <span class="n">maxx</span><span class="o">.</span><span class="n">value</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">CCD_MAX_Y</span> <span class="o">=</span> <span class="n">maxy</span><span class="o">.</span><span class="n">value</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">CCD_PIXEL_SIZE</span> <span class="o">=</span> <span class="n">pix_size</span><span class="o">.</span><span class="n">value</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">CCD_PIXEL_SIZE_X</span> <span class="o">=</span> <span class="n">pix_size_x</span><span class="o">.</span><span class="n">value</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">CCD_PIXEL_SIZE_Y</span> <span class="o">=</span> <span class="n">pix_size_y</span><span class="o">.</span><span class="n">value</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">CCD_BITSPERPIXEL</span> <span class="o">=</span> <span class="n">bpp</span><span class="o">.</span><span class="n">value</span>

        <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="Camera.get_pixelsize"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_pixelsize">[docs]</a>    <span class="k">def</span> <span class="nf">get_pixelsize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ccd_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ccd_info</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ccd_info</span><span class="o">.</span><span class="n">CCD_PIXEL_SIZE_X</span><span class="p">,</span> <span class="n">ccd_info</span><span class="o">.</span><span class="n">CCD_PIXEL_SIZE_Y</span></div>

<div class="viewcode-block" id="Camera.get_egain"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_egain">[docs]</a>    <span class="k">def</span> <span class="nf">get_egain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="c1"># FIXME need to see how gain is represented in drivers like ASI</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Camera.get_egain() is not implemented for INDI!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Camera.get_camera_gain"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_camera_gain">[docs]</a>    <span class="k">def</span> <span class="nf">get_camera_gain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Looks for camera specific gain - only works for ASI afaik&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">:</span>
            <span class="n">ccd_controls</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_CONTROLS&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ccd_controls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">ccd_gain</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_controls</span><span class="p">,</span> <span class="s1">&#39;Gain&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ccd_gain</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="n">ccd_gain</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Camera.get_camera_offset"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_camera_offset">[docs]</a>    <span class="k">def</span> <span class="nf">get_camera_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Looks for camera specific offset - only works for ASI afaik&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">:</span>
            <span class="n">ccd_controls</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_CONTROLS&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ccd_controls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">ccd_offset</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_controls</span><span class="p">,</span> <span class="s1">&#39;Offset&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ccd_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="n">ccd_offset</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Camera.get_camera_usbbandwidth"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_camera_usbbandwidth">[docs]</a>    <span class="k">def</span> <span class="nf">get_camera_usbbandwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Looks for camera specific usb traffic - only works for ASI afaik&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">:</span>
            <span class="n">ccd_controls</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_CONTROLS&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ccd_controls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">ccd_usb</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_controls</span><span class="p">,</span> <span class="s1">&#39;BandWidth&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ccd_usb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="n">ccd_usb</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Camera.get_current_temperature"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_current_temperature">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getfindNumberValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_TEMPERATURE&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;CCD_TEMPERATURE_VALUE&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camera.get_target_temperature"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_target_temperature">[docs]</a>    <span class="k">def</span> <span class="nf">get_target_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature_target</span></div>

<div class="viewcode-block" id="Camera.set_target_temperature"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.set_target_temperature">[docs]</a>    <span class="k">def</span> <span class="nf">set_target_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp_c</span><span class="p">):</span>
        <span class="c1"># FIXME Handling ccd temperature needs to be more robust</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature_target</span> <span class="o">=</span> <span class="n">temp_c</span>
        <span class="k">return</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">setfindNumberValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span>
                                             <span class="s1">&#39;CCD_TEMPERATURE&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;CCD_TEMPERATURE_VALUE&#39;</span><span class="p">,</span>
                                             <span class="n">temp_c</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camera.set_cooler_state"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.set_cooler_state">[docs]</a>    <span class="k">def</span> <span class="nf">set_cooler_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onoff</span><span class="p">):</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">setfindSwitchState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span>
                                          <span class="s1">&#39;CCD_COOLER&#39;</span><span class="p">,</span> <span class="s1">&#39;COOLER_ON&#39;</span><span class="p">,</span>
                                           <span class="n">onoff</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rc</span>

        <span class="n">rc</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">setfindSwitchState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span>
                                          <span class="s1">&#39;CCD_COOLER&#39;</span><span class="p">,</span> <span class="s1">&#39;COOLER_OFF&#39;</span><span class="p">,</span>
                                           <span class="ow">not</span> <span class="n">onoff</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rc</span></div>

<div class="viewcode-block" id="Camera.get_cooler_state"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_cooler_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_cooler_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getfindSwitchState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_COOLER&#39;</span><span class="p">,</span> <span class="s1">&#39;COOLER_ON&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camera.get_binning"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_binning">[docs]</a>    <span class="k">def</span> <span class="nf">get_binning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ccd_bin</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_BINNING&#39;</span><span class="p">)</span>
        <span class="n">binx</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_bin</span><span class="p">,</span> <span class="s1">&#39;HOR_BIN&#39;</span><span class="p">)</span>
        <span class="n">biny</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_bin</span><span class="p">,</span> <span class="s1">&#39;VER_BIN&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">binx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">biny</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">binx</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">biny</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camera.get_cooler_power"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_cooler_power">[docs]</a>    <span class="k">def</span> <span class="nf">get_cooler_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera_has_cooler_power</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">cool_power</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_COOLER_POWER&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cool_power</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera_has_cooler_power</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">cool_power</span><span class="p">,</span> <span class="s1">&#39;CCD_COOLER_VALUE&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera_has_cooler_power</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="n">value</span></div>

<div class="viewcode-block" id="Camera.set_binning"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.set_binning">[docs]</a>    <span class="k">def</span> <span class="nf">set_binning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binx</span><span class="p">,</span> <span class="n">biny</span><span class="p">):</span>
        <span class="n">ccd_bin</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_BINNING&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ccd_bin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">num_binx</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_bin</span><span class="p">,</span> <span class="s1">&#39;HOR_BIN&#39;</span><span class="p">)</span>
        <span class="n">num_biny</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_bin</span><span class="p">,</span> <span class="s1">&#39;VER_BIN&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_binx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">num_biny</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">num_binx</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">binx</span>
        <span class="n">num_biny</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">biny</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="o">.</span><span class="n">sendNewNumber</span><span class="p">(</span><span class="n">ccd_bin</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Camera.get_max_binning"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_max_binning">[docs]</a>    <span class="k">def</span> <span class="nf">get_max_binning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="c1">#        logging.warning(&#39;Camera.get_max_binning() is not implemented for INDI!&#39;)</span>
<span class="c1">#        return None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">:</span>
            <span class="n">ccd_bin</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_BINNING&#39;</span><span class="p">)</span>
            <span class="c1">#logging.info(f&#39;ccd_bin={ccd_bin}&#39;)</span>
            <span class="k">if</span> <span class="n">ccd_bin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">ccd_hbin</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_bin</span><span class="p">,</span> <span class="s1">&#39;HOR_BIN&#39;</span><span class="p">)</span>
            <span class="c1">#logging.info(f&#39;ccd_hbin={indihelper.dump_Number(ccd_hbin)}&#39;)</span>
            <span class="k">if</span> <span class="n">ccd_hbin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="n">ccd_hbin</span><span class="o">.</span><span class="n">max</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Camera.get_size"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_size">[docs]</a>    <span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ccd_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_info</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ccd_info</span><span class="o">.</span><span class="n">CCD_MAX_X</span><span class="p">,</span> <span class="n">ccd_info</span><span class="o">.</span><span class="n">CCD_MAX_Y</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camera.get_frame"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.get_frame">[docs]</a>    <span class="k">def</span> <span class="nf">get_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ccd_frame</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_FRAME&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ccd_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">ccd_x</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_frame</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ccd_y</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_frame</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ccd_w</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_frame</span><span class="p">,</span> <span class="s1">&#39;WIDTH&#39;</span><span class="p">)</span>
        <span class="n">ccd_h</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_frame</span><span class="p">,</span> <span class="s1">&#39;HEIGHT&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ccd_x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ccd_y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ccd_w</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ccd_h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ccd_x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ccd_y</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ccd_w</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ccd_h</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camera.set_frame"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Camera.set_frame">[docs]</a>    <span class="k">def</span> <span class="nf">set_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
        <span class="n">ccd_frame</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">,</span> <span class="s1">&#39;CCD_FRAME&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ccd_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">ccd_x</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_frame</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ccd_y</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_frame</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ccd_w</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_frame</span><span class="p">,</span> <span class="s1">&#39;WIDTH&#39;</span><span class="p">)</span>
        <span class="n">ccd_h</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">ccd_frame</span><span class="p">,</span> <span class="s1">&#39;HEIGHT&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;set_frame: </span><span class="si">{minx}</span><span class="s1"> </span><span class="si">{miny}</span><span class="s1"> </span><span class="si">{width}</span><span class="s1"> </span><span class="si">{height}</span><span class="s1"> </span><span class="si">{ccd_x.value}</span><span class="s1"> </span><span class="si">{ccd_y.value}</span><span class="s1"> </span><span class="si">{ccd_w.value}</span><span class="s1"> </span><span class="si">{ccd_h.value}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ccd_x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ccd_y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ccd_w</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ccd_h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">ccd_x</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">minx</span>
        <span class="n">ccd_y</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">miny</span>
        <span class="n">ccd_w</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">width</span>
        <span class="n">ccd_h</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="o">.</span><span class="n">sendNewNumber</span><span class="p">(</span><span class="n">ccd_frame</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>

<div class="viewcode-block" id="Focuser"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Focuser">[docs]</a><span class="k">class</span> <span class="nc">Focuser</span><span class="p">(</span><span class="n">BaseFocuser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focuser</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indiclient</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># some focusers do not have a numbers so dont</span>
        <span class="c1"># keep trying it as the timeout waiting for</span>
        <span class="c1"># response hurts apps that poll</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focuser_has_max_travel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focuser_has_temperature</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">5</span>

<div class="viewcode-block" id="Focuser.has_chooser"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Focuser.has_chooser">[docs]</a>    <span class="k">def</span> <span class="nf">has_chooser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Focuser.show_chooser"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Focuser.show_chooser">[docs]</a>    <span class="k">def</span> <span class="nf">show_chooser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_choice</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Focuser.show_chooser() is not implemented for INDI!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Focuser.connect"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Focuser.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Connecting to focuser device: </span><span class="si">{name}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">focuser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Focuser.connect() self.focuser is not None!&#39;</span><span class="p">)</span>

        <span class="n">focuser</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">connectDevice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="c1">#logging.info(f&#39;connectDevice returned {focuser}&#39;)</span>

        <span class="k">if</span> <span class="n">focuser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focuser</span> <span class="o">=</span> <span class="n">focuser</span>

            <span class="c1"># reset flag(s)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focuser_has_max_travel</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focuser_has_temperature</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Focuser.disconnect"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Focuser.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focuser</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#logging.warning(&#39;Focuser.disconnect() is not implemented for INDI!&#39;)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Focuser.is_connected"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Focuser.is_connected">[docs]</a>    <span class="k">def</span> <span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">focuser</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">focuser</span><span class="o">.</span><span class="n">isConnected</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Focuser.get_absolute_position"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Focuser.get_absolute_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_absolute_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getfindNumberValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focuser</span><span class="p">,</span> <span class="s1">&#39;ABS_FOCUS_POSITION&#39;</span><span class="p">,</span> <span class="s1">&#39;FOCUS_ABSOLUTE_POSITION&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Focuser.move_absolute_position"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Focuser.move_absolute_position">[docs]</a>    <span class="k">def</span> <span class="nf">move_absolute_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">abspos</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">setfindNumberValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">focuser</span><span class="p">,</span>
                                             <span class="s1">&#39;ABS_FOCUS_POSITION&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;FOCUS_ABSOLUTE_POSITION&#39;</span><span class="p">,</span>
                                             <span class="nb">float</span><span class="p">(</span><span class="n">abspos</span><span class="p">))</span></div>

<div class="viewcode-block" id="Focuser.get_max_absolute_position"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Focuser.get_max_absolute_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_max_absolute_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Moonlite driver defines max travel</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">focuser_has_max_travel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">maxpos</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getfindNumberValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focuser</span><span class="p">,</span> <span class="s1">&#39;FOCUS_MAXTRAVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;MAXTRAVEL&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">maxpos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">maxpos</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">focuser_has_max_travel</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># try using max value for abs pos slider</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getfindNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focuser</span><span class="p">,</span> <span class="s1">&#39;ABS_FOCUS_POSITION&#39;</span><span class="p">,</span> <span class="s1">&#39;FOCUS_ABSOLUTE_POSITION&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">max</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Focuser.get_current_temperature"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Focuser.get_current_temperature">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">focuser_has_temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">curtemp</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getfindNumberValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focuser</span><span class="p">,</span> <span class="s1">&#39;FOCUS_TEMPERATURE&#39;</span><span class="p">,</span> <span class="s1">&#39;TEMPERATURE&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">curtemp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">curtemp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">focuser_has_temperature</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Focuser.stop"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Focuser.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">setfindSwitchState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">focuser</span><span class="p">,</span>
                                             <span class="s1">&#39;FOCUS_ABORT_MOTION&#39;</span><span class="p">,</span> <span class="s1">&#39;ABORT&#39;</span><span class="p">,</span>
                                             <span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Focuser.is_moving"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Focuser.is_moving">[docs]</a>    <span class="k">def</span> <span class="nf">is_moving</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumberState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focuser</span><span class="p">,</span> <span class="s1">&#39;ABS_FOCUS_POSITION&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PyIndi</span><span class="o">.</span><span class="n">IPS_BUSY</span></div></div>

<div class="viewcode-block" id="FilterWheel"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.FilterWheel">[docs]</a><span class="k">class</span> <span class="nc">FilterWheel</span><span class="p">(</span><span class="n">BaseFilterWheel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filterwheel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indiclient</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">5</span>

<div class="viewcode-block" id="FilterWheel.has_chooser"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.FilterWheel.has_chooser">[docs]</a>    <span class="k">def</span> <span class="nf">has_chooser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FilterWheel.show_chooser"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.FilterWheel.show_chooser">[docs]</a>    <span class="k">def</span> <span class="nf">show_chooser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_choice</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;FilterWheel.show_chooser() is not implemented for INDI!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FilterWheel.connect"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.FilterWheel.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Connecting to filterwheel device: </span><span class="si">{name}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterwheel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;FilterWheel.connect() self.filterwheel is not None!&#39;</span><span class="p">)</span>

        <span class="n">fw</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">connectDevice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="c1">#logging.info(f&#39;connectDevice returned {fw}&#39;)</span>

        <span class="k">if</span> <span class="n">fw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filterwheel</span> <span class="o">=</span> <span class="n">fw</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FilterWheel.disconnect"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.FilterWheel.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filterwheel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#logging.warning(&#39;FilterWheel.disconnect() is not implemented for INDI!&#39;)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FilterWheel.is_connected"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.FilterWheel.is_connected">[docs]</a>    <span class="k">def</span> <span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterwheel</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterwheel</span><span class="o">.</span><span class="n">isConnected</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FilterWheel.get_position"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.FilterWheel.get_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Position starts at 0! &quot;&quot;&quot;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getfindNumberValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filterwheel</span><span class="p">,</span>
                                            <span class="s1">&#39;FILTER_SLOT&#39;</span><span class="p">,</span> <span class="s1">&#39;FILTER_SLOT_VALUE&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FilterWheel.get_position_name"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.FilterWheel.get_position_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_position_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#FIXME this should check return from get names, etc</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_names</span><span class="p">()[</span><span class="nb">int</span><span class="p">(</span><span class="n">pos</span><span class="p">)]</span></div>

<div class="viewcode-block" id="FilterWheel.set_position"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.FilterWheel.set_position">[docs]</a>    <span class="k">def</span> <span class="nf">set_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sends request to driver to move filter wheel position</span>

<span class="sd">        This DOES NOT wait for filter to move into position!</span>

<span class="sd">        Use is_moving() method to check if its done.</span>

<span class="sd">        Positions start at 0!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_num_positions</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">setfindNumberValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">filterwheel</span><span class="p">,</span>
                                                     <span class="s1">&#39;FILTER_SLOT&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;FILTER_SLOT_VALUE&#39;</span><span class="p">,</span>
                                                     <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FilterWheel.set_position_name"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.FilterWheel.set_position_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_position_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sends request to driver to move filter wheel position</span>

<span class="sd">        This DOES NOT wait for filter to move into position!</span>

<span class="sd">        Use is_moving() method to check if its done.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_names</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">newpos</span> <span class="o">=</span> <span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">newpos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">newpos</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">newpos</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="FilterWheel.is_moving"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.FilterWheel.is_moving">[docs]</a>    <span class="k">def</span> <span class="nf">is_moving</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumberState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filterwheel</span><span class="p">,</span> <span class="s1">&#39;FILTER_SLOT&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PyIndi</span><span class="o">.</span><span class="n">IPS_BUSY</span>


        <span class="n">state</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getfindLightState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filterwheel</span><span class="p">,</span>
                                             <span class="s1">&#39;FILTER_SLOT&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PyIndi</span><span class="o">.</span><span class="n">IPS_BUSY</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;FilterWheel.is_moving() is not implemented for INDI!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FilterWheel.get_names"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.FilterWheel.get_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># lookup filter names from driver</span>
        <span class="n">filter_name_prop</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filterwheel</span><span class="p">,</span> <span class="s1">&#39;FILTER_NAME&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filter_name_prop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">filter_name_prop</span><span class="o">.</span><span class="n">ntp</span><span class="p">):</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filter_name_prop</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">names</span></div>

<div class="viewcode-block" id="FilterWheel.get_num_positions"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.FilterWheel.get_num_positions">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_names</span><span class="p">())</span></div></div>

<div class="viewcode-block" id="Mount"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount">[docs]</a><span class="k">class</span> <span class="nc">Mount</span><span class="p">(</span><span class="n">BaseMount</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mount</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indiclient</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_altaz_coord</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">5</span>

<div class="viewcode-block" id="Mount.has_chooser"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount.has_chooser">[docs]</a>    <span class="k">def</span> <span class="nf">has_chooser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Mount.show_chooser"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount.show_chooser">[docs]</a>    <span class="k">def</span> <span class="nf">show_chooser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_choice</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Mount.show_chooser() is not implemented for INDI!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Mount.connect"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Connecting to mount device: </span><span class="si">{name}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Mount.connect() self.mount is not None!&#39;</span><span class="p">)</span>

        <span class="n">mount</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">connectDevice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="c1">#logging.debug(f&#39;connectDevice returned {mount}&#39;)</span>

        <span class="k">if</span> <span class="n">mount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mount</span> <span class="o">=</span> <span class="n">mount</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Mount.disconnect"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mount</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#logging.warning(&#39;Mount.disconnect() is not implemented for INDI!&#39;)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Mount.is_connected"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount.is_connected">[docs]</a>    <span class="k">def</span> <span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mount</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mount</span><span class="o">.</span><span class="n">isConnected</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Mount.can_park"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount.can_park">[docs]</a>    <span class="k">def</span> <span class="nf">can_park</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Mount.can_park() is not implemented for INDI!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Mount.is_parked"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount.is_parked">[docs]</a>    <span class="k">def</span> <span class="nf">is_parked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Mount.is_parked() is not implemented for INDI!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Mount.get_position_altaz"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount.get_position_altaz">[docs]</a>    <span class="k">def</span> <span class="nf">get_position_altaz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns tuple of (alt, az) in degrees&quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="c1"># NOTE seems like some (most?) INDI GEM drivers don&#39;t return alt/az</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_altaz_coord</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">az</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getfindNumberValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mount</span><span class="p">,</span> <span class="s1">&#39;HORIZONTAL_COORD&#39;</span><span class="p">,</span><span class="s1">&#39;AZ&#39;</span><span class="p">)</span>
            <span class="n">alt</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getfindNumberValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mount</span><span class="p">,</span> <span class="s1">&#39;HORIZONTAL_COORD&#39;</span><span class="p">,</span><span class="s1">&#39;ALT&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">az</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">alt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">has_altaz_coord</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">az</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">alt</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">alt</span><span class="p">,</span> <span class="n">az</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mount.get_position_radec"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount.get_position_radec">[docs]</a>    <span class="k">def</span> <span class="nf">get_position_radec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns tuple of (ra, dec) with ra in decimal hours and dec in degrees&quot;&quot;&quot;</span>
        <span class="n">ra</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getfindNumberValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mount</span><span class="p">,</span>
                                           <span class="s1">&#39;EQUATORIAL_EOD_COORD&#39;</span><span class="p">,</span><span class="s1">&#39;RA&#39;</span><span class="p">)</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getfindNumberValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mount</span><span class="p">,</span>
                                            <span class="s1">&#39;EQUATORIAL_EOD_COORD&#39;</span><span class="p">,</span><span class="s1">&#39;DEC&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mount.is_slewing"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount.is_slewing">[docs]</a>    <span class="k">def</span> <span class="nf">is_slewing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumberState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mount</span><span class="p">,</span> <span class="s1">&#39;EQUATORIAL_EOD_COORD&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PyIndi</span><span class="o">.</span><span class="n">IPS_BUSY</span></div>

<div class="viewcode-block" id="Mount.abort_slew"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount.abort_slew">[docs]</a>    <span class="k">def</span> <span class="nf">abort_slew</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">setfindSwitchState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mount</span><span class="p">,</span>
                                             <span class="s1">&#39;TELESCOPE_ABORT_MOTION&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;ABORT_MOTION&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mount.park"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount.park">[docs]</a>    <span class="k">def</span> <span class="nf">park</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Mount.park() is not implemented for INDI!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Mount.slew"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount.slew">[docs]</a>    <span class="k">def</span> <span class="nf">slew</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Slew to ra/dec with ra in decimal hours and dec in degrees&quot;&quot;&quot;</span>
        <span class="n">indihelper</span><span class="o">.</span><span class="n">setfindSwitchState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mount</span><span class="p">,</span>
                                      <span class="s1">&#39;ON_COORD_SET&#39;</span><span class="p">,</span> <span class="s1">&#39;TRACK&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">eq_coord</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mount</span><span class="p">,</span> <span class="s1">&#39;EQUATORIAL_EOD_COORD&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eq_coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">ra_coord</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">eq_coord</span><span class="p">,</span><span class="s1">&#39;RA&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ra_coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">dec_coord</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">eq_coord</span><span class="p">,</span> <span class="s1">&#39;DEC&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dec_coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">ra_coord</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">ra</span>
        <span class="n">dec_coord</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">dec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="o">.</span><span class="n">sendNewNumber</span><span class="p">(</span><span class="n">eq_coord</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Mount.sync"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount.sync">[docs]</a>    <span class="k">def</span> <span class="nf">sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sync to ra/dec with ra in decimal hours and dec in degrees&quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;sync to </span><span class="si">{ra}</span><span class="s1"> </span><span class="si">{dec}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1">#logging.debug(&#39;finding) ON_COORD_SET switch&#39;)</span>
        <span class="n">indihelper</span><span class="o">.</span><span class="n">setfindSwitchState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mount</span><span class="p">,</span>
                                      <span class="s1">&#39;ON_COORD_SET&#39;</span><span class="p">,</span> <span class="s1">&#39;SYNC&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1">#logging.debug(&#39;getNumber EQUATORIAL_EOD_COORD&#39;)</span>
        <span class="n">eq_coord</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mount</span><span class="p">,</span> <span class="s1">&#39;EQUATORIAL_EOD_COORD&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eq_coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1">#logging.debug(&#39;findNumber &quot;RA&quot;&#39;)</span>
        <span class="n">ra_coord</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">eq_coord</span><span class="p">,</span><span class="s1">&#39;RA&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ra_coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1">#logging.debug(&#39;findNumber &quot;DEC&quot;&#39;)</span>
        <span class="n">dec_coord</span> <span class="o">=</span> <span class="n">indihelper</span><span class="o">.</span><span class="n">findNumber</span><span class="p">(</span><span class="n">eq_coord</span><span class="p">,</span> <span class="s1">&#39;DEC&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dec_coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1">#logging.debug(f&#39;{ra_coord.value} {dec_coord.value}&#39;)</span>
        <span class="n">ra_coord</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">ra</span>
        <span class="n">dec_coord</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">dec</span>
        <span class="c1">#logging.debug(f&#39;{ra_coord.value} {dec_coord.value}&#39;)</span>
        <span class="c1">#logging.debug(&#39;sending Number&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">indiclient</span><span class="o">.</span><span class="n">sendNewNumber</span><span class="p">(</span><span class="n">eq_coord</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Mount.unpark"><a class="viewcode-back" href="../../pyastrobackend.html#pyastrobackend.INDIBackend.Mount.unpark">[docs]</a>    <span class="k">def</span> <span class="nf">unpark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Mount.unpark() is not implemented for INDI!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Michael Fulbright

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>